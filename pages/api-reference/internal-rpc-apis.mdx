export const type = "page"
export const title = "Internal RPC API Reference"
# Internal RPC API Reference

Beyond the main [Webizen Core API](./webizen-api), the platform uses a set of internal, lower-level APIs for communication between the foreground (UI) process and the background process. These APIs are defined using a Remote Procedure Call (RPC) system and handle many of the core, browser-like functionalities inherited from the Beaker Browser architecture.

## Overview

-   **Location**: The manifests for these APIs are located in `app/bg/web-apis/manifests/internal/`.
-   **Purpose**: To provide the UI with granular access to browser-level features like history, bookmarks, and the underlying file systems (Hyperdrives).
-   **Usage**: These APIs are typically not called directly by high-level modules. Instead, they are used by core UI components and services in the foreground (`fg`) to populate views and handle user interactions. They are exposed to the foreground window via the `preload.js` script.

---

## Key Internal APIs

While there are many internal APIs, this document highlights some of the most critical ones that a developer might need to be aware of.

### 1. `beaker-filesystem` API

This is a low-level API for interacting with the user's private and public Hyperdrives.

-   **Manifest**: `app/bg/web-apis/manifests/internal/beaker-filesystem.js`
-   **Description**: Provides methods for reading, writing, and managing files and directories within the user's personal storage drives. It also includes methods for watching for file changes.

#### Selected Methods

-   **`stat(url)`**: Retrieves metadata about a file or directory (e.g., size, type, modification time).
-   **`readFile(url, opts)`**: Reads the content of a file. `opts` can specify encoding.
-   **`writeFile(url, data, opts)`**: Writes data to a file, overwriting it if it exists.
-   **`readdir(url, opts)`**: Reads the contents of a directory, returning a list of files and subdirectories.
-   **`mkdir(url)`**: Creates a new directory at the specified path.
-   **`watch(url)`**: Creates a real-time event stream for file system changes at a given URL.

---

### 2. `bookmarks` API

Manages the user's bookmarks.

-   **Manifest**: `app/bg/web-apis/manifests/internal/bookmarks.js`
-   **Description**: Provides CRUD (Create, Read, Update, Delete) operations for bookmarks, which are stored as RDF data in the user's profile graph.

#### Selected Methods

-   **`list()`**: Returns a list of all bookmarks.
-   **`get(url)`**: Retrieves the data for a single bookmark.
-   **`add(bookmarkData)`**: Creates a new bookmark. `bookmarkData` is an object containing `href`, `title`, `tags`, etc.
-   **`edit(href, updates)`**: Modifies an existing bookmark.
-   **`remove(href)`**: Deletes a bookmark.

---

### 3. `history` API

Manages the user's browsing history.

-   **Manifest**: `app/bg/web-apis/manifests/internal/history.js`
-   **Description**: Provides methods for adding, querying, and removing entries from the browsing history database.

#### Selected Methods

-   **`add(visit)`**: Adds a new visit to the history. The `visit` object includes the `url`, `title`, and timestamp.
-   **`get(url)`**: Retrieves all visit records for a specific URL.
-   **`search(query)`**: Performs a full-text search over the history records.
-   **`remove(url)`**: Removes all visits associated with a specific URL from the history.
-   **`removeAll()`**: Clears the entire browsing history.

These internal APIs provide the essential glue between the user interface and the core data management services running in the background, enabling the rich, application-like experience of Webizen.
