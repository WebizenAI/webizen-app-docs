# export const type = "page"
# export const title = "Module: Resource Management"
# Module: Resource Management

**The Resource Management module provides a system for dynamically loading and unloading large, shared data assets, such as HDF5 files, on demand. It ensures that the application uses memory and network resources efficiently.**

This module is a critical backend service that allows other modules, particularly the AI and i18n modules, to access large datasets without needing to bundle them with the application.

## Purpose and Functionality

The primary goal of the `resources` module is to manage the lifecycle of large data assets. Instead of loading all possible resources into memory at startup, this module fetches them from the network only when they are needed and unloads them when they are not.

**Core Functions:**
-   **Dynamic Loading:** It provides a service for other modules to request a resource via its URI. The module then handles fetching the resource from the most efficient P2P source available.
-   **P2P Fetching:** It integrates with the `webtorrent` and `ipfs` services to download resource files from the decentralized network.
-   **HDF5 Processing:** It is specifically designed to handle HDF5 (`.h5`) files, a format used for storing large amounts of scientific and numerical data. It uses the `h5wasm` library (which runs in WebAssembly) to parse and provide access to the data within these files directly in the JavaScript environment.
-   **Context-Aware Caching:** It manages a local cache of frequently used resources to avoid repeated downloads. The caching is context-aware, meaning it can prioritize keeping resources in memory based on the user's current activity.

## Technical Implementation

-   **Module Path**: `src/modules/resources/index.js`
-   **Core Libraries**:
    -   `h5wasm`: For parsing HDF5 files in a WebAssembly environment.
-   **Ontology**: `ontologies/resources-v1.ttl` defines the RDF schema for describing resources, including their format, location (CID), and dependencies.
-   **Dependencies**:
    -   `services/webtorrent` & `services/ipfs`: To download the resource files from the P2P network.
    -   `services/webizen-api`: Specifically the `/resources/load` endpoint, which this module powers.

### Example Flow: Loading a Language Resource

1.  The `i18n` module needs to provide support for a new language, Quechua (`qu`), which is stored in a large HDF5 file.
2.  It first queries the `quadstore` to find the resource description for the Quechua language pack, which contains its IPFS CID.
3.  It then dispatches an event: `eventBus.emit('resources:request', { resourceUri: 'ipfs://bafy...' })`.
4.  The `resources` module's `handleEvent` function receives this request.
5.  It checks its local cache. If the resource is not present, it uses the `ipfs` service to download the HDF5 file.
6.  Once the file is downloaded, the module uses `h5wasm` to parse the binary HDF5 file.
7.  It extracts the necessary data (e.g., the translation keys and strings) from the parsed HDF5 structure.
8.  It then dispatches a success event with the data payload: `eventBus.emit('resources:loaded', { resourceUri: 'ipfs://bafy...', data: { ... } })`.
9.  The `i18n` module receives this event and can now use the Quechua translation data. When the user switches to another language, the `i18n` module can dispatch a `resources:release` event to tell the resource manager that it can unload the Quechua data from memory if needed.
