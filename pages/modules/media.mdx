# Module: Media Sharing

**The Media Sharing module provides the functionality for sharing large files, such as videos and PDFs, directly between peers using the WebTorrent protocol. It also integrates with Webizen's rights and payment systems to enable creators to charge for access to their content.**

This module is a core component for building a decentralized content distribution and monetization ecosystem.

## Purpose and Functionality

The primary goal of the `media` module is to provide a robust and efficient mechanism for P2P file sharing, bypassing the need for expensive, centralized hosting providers.

**Core Functions:**
-   **WebTorrent Integration:** It uses the `webtorrent` service to create, seed, and download files. When a user shares a file, the module generates a `magnet:` link that can be shared with others.
-   **Paid Access Control:** This is a key feature for content creators. The module can enforce paid access to a file. It does this by encrypting the file content and only releasing the decryption key after verifying an eCash payment.
-   **ODRL Policy Enforcement:** The terms of access (e.g., the price, the currency) are defined in a machine-readable **ODRL** policy that is shared alongside the media file. The module parses this policy to determine the access requirements.
-   **ECDSA for Verification:** eCash payment verification is handled by the `cashtab` module, which uses ECDSA signatures to interact with the blockchain.

## Technical Implementation

-   **Module Path**: `src/modules/media/index.js`
-   **UI Component**: The interface for uploading, sharing, and viewing media is handled by `src/components/Media.js`.
-   **Core Libraries**:
    -   `webtorrent`: For all P2P file transfer operations.
    -   `CryptoJS`: Used for the AES encryption of the media file content.
-   **Dependencies**:
    -   `modules/cashtab`: To verify eCash payments for paid content.
    -   `modules/agreements`: The ODRL policies are a form of agreement that this module enforces.
    -   `services/webtorrent`: The service that manages the core WebTorrent client.
    -   `services/crypto`: For encrypting the file content and handling any signatures related to the ODRL policy.

### Example Flow: Sharing and Accessing a Paid Video

1.  **Creator (Alice) Shares a Video:**
    a. Alice selects a video file (`my-film.mp4`) in the `Media.js` UI.
    b. She specifies a price of 20,000 XEC in an ODRL policy.
    c. The `media` module encrypts `my-film.mp4` with a new AES key.
    d. It creates a torrent for the *encrypted* file and generates a `magnet:` link.
    e. It stores the AES decryption key, the ODRL policy, and the magnet link in a new RDF resource in her Solid Pod, making it discoverable.

2.  **Consumer (Bob) Accesses the Video:**
    a. Bob discovers the magnet link for Alice's film. He starts downloading the encrypted file via WebTorrent.
    b. His client also fetches the ODRL policy, which states that the `play` action requires a 20,000 XEC payment.
    c. Bob's UI displays a "Pay 20,000 XEC to Watch" button. He clicks it.
    d. The `cashtab` module facilitates the payment to Alice's eCash address.
    e. Once the transaction is confirmed on the blockchain, Bob's client sends a notification (with the transaction ID) to Alice's client.
    f. Alice's client verifies the payment. Upon success, it securely sends the AES decryption key for the video file to Bob's client.
    g. Bob's `media` module can now decrypt the file as it downloads, allowing him to stream the video.

This workflow enables true peer-to-peer content monetization, where the creator maintains control and receives payment directly from the consumer, without any intermediary platform taking a cut.
