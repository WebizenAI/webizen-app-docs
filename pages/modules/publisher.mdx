# Module: Publisher

**The Publisher module is a sophisticated content creation environment designed for authoring rich, multi-page documents and publications. It integrates a powerful WYSIWYG editor, real-time collaboration, and flexible publishing options to serve as Webizen's primary tool for creating high-quality hypermedia content.**

This module is the successor to the basic `editor` module, leveraging a more advanced toolkit to support complex "publications" rather than just single files.

## Purpose and Functionality

The primary goal of the `publisher` module is to provide a user-friendly, powerful, and collaborative authoring experience that rivals traditional desktop publishing software, but within a decentralized framework.

**Core Functions:**
-   **Rich Text Editing with CKEditor 5:** The module is built around the `@ckeditor/ckeditor5-react` component, providing a modern and highly extensible WYSIWYG editing experience.
-   **Tabbed/Multi-Page Documents:** Unlike a standard editor, the Publisher is designed to work with "publications" which can contain multiple pages or sections, managed through a tabbed interface.
-   **CML (Context Markup Language) Support:** The editor is configured with custom plugins to support CML. This allows authors to semantically annotate their text (e.g., tagging a sentence as a `cml:Claim` or a `cml:Question`), making the content machine-readable.
-   **Real-time Collaboration:** It integrates with **GUN.eco** to allow multiple users to edit the same publication simultaneously, with changes reflected in real-time for all participants.
-   **Flexible Publishing Options:** When a publication is ready, the author can choose how to share it:
    -   **Publicly:** The content is packaged into a standard, unsigned Hypermedia Content Package and shared on IPFS for anyone to access.
    -   **Permissively:** The content is packaged, encrypted, and signed. Access is controlled by a specific **ODRL** policy, allowing for private, shared, or paid content.

## Technical Implementation

-   **Module Path**: `src/modules/publisher/index.js`
-   **UI Component**: The main publisher interface is rendered by `src/components/Publisher.js`, which wraps the CKEditor 5 component and adds the tabbing and publishing UI.
-   **Core Libraries**:
    -   `@ckeditor/ckeditor5-react`: For the core editing experience.
    -   `gun`: For the real-time collaboration backend.
-   **Dependencies**:
    -   `modules/hypermedia`: For bundling the final publication into a Hypermedia Content Package.
    -   `modules/agreements` & `services/odrl`: To create and attach the ODRL policies for permissive publishing.
    -   `services/p2p`: Manages the underlying GUN.eco connection for collaboration.
    -   `services/crypto`: For signing and encrypting packages that are published permissively.
    -   `services/ipfs`: To store the final published package.

### Example Flow: Collaboratively Writing and Publishing a Paper

1.  **Creation:** Alice starts a new publication in the Publisher module. This creates a new multi-page document structure.
2.  **Collaboration:** Alice invites Bob to collaborate. The module establishes a shared GUN.eco graph for the document's content. As Alice and Bob type in their respective `Publisher.js` instances, the changes are synced in real-time via GUN.
3.  **Annotation:** Alice highlights a sentence and uses a custom CKEditor button to tag it with `cml:Hypothesis`. This adds the corresponding RDFa annotation directly into the document's HTML.
4.  **Publishing:** Once complete, Alice clicks "Publish." The UI asks if she wants to publish publicly or permissively. She chooses "Permissive" and sets a policy requiring attribution.
5.  **Packaging:** The `publisher` module gathers all the document's pages (tabs), the CML annotations, and the ODRL policy. It calls the `hypermedia` module to bundle these assets into an encrypted and signed Hypermedia Content Package.
6.  **Sharing:** The final package is uploaded to IPFS, and its CID is made available for sharing. Only users who meet the ODRL policy's requirements will be able to decrypt and view the content.
