# export const type = "page"
# export const title = "Module: Chat"
# Module: Chat

**The Chat module is Webizen's primary real-time communication component. It provides a secure, decentralized, and feature-rich messaging experience, integrating P2P protocols with native platform capabilities.**

This module enables everything from simple one-on-one text chats to complex, annotated group conversations and even SMS/MMS integration on mobile devices.

## Purpose and Functionality

The primary goal of the `chat` module is to provide a unified communication interface that is private, censorship-resistant, and extensible.

**Core Functions:**
-   **Multi-Protocol Backend:** The module uses a hybrid approach for message transport, leveraging the best tool for each scenario:
    -   **GUN.eco:** For decentralized, real-time data synchronization in group chats.
    -   **WebRTC:** For establishing direct, end-to-end encrypted data channels for one-on-one chats and file transfers.
    -   **WebSockets:** As a reliable fallback for communication when a direct P2P connection cannot be established.
-   **Mobile Integration:** On the Mobile App, the chat module can be configured to act as the default SMS/MMS handler, allowing users to manage both decentralized Webizen messages and traditional cellular messages in one place.
-   **Call Recording & Sharing:** Integrates with the device's calling features to record conversations (with consent) and securely share the recordings with other users via their ADP/WebID.
-   **Context Markup Language (CML):** A key innovation where chat messages can be semantically annotated using CML. For example, a piece of text can be tagged as a `cml:Question` or a `cml:Task`. These annotations are discoverable, allowing a domain owner (e.g., a project manager) to query a chat history for all unresolved tasks.

## Technical Implementation

-   **Module Path**: `src/modules/chat/index.js`
-   **UI Component**: The main chat interface is rendered by `src/components/Chat.js`.
-   **Core Libraries**:
    -   `GUN.eco`: For the real-time database backend.
    -   `react-native-sms`, `react-native-callkeep`: For native mobile integrations.
-   **Ontology**: `ontologies/cml-v1.ttl` defines the vocabulary for Context Markup Language annotations.
-   **Dependencies**:
    -   `modules/adp`: For verifying the identity of chat participants.
    -   `modules/addressbook`: To initiate chats with known contacts.
    -   `services/p2p`: A wrapper service that manages the GUN, WebRTC, and WebSocket connections.
    -   `services/crypto`: To handle the end-to-end encryption of messages. All messages are encrypted using a shared secret derived from the participants' keys.

### Example Flow: Sending an Annotated Message

1.  User Alice types a message in the `Chat.js` component: "Can someone please create a new logo for Project X?"
2.  She highlights "create a new logo for Project X" and uses a UI element to tag it as a `cml:Task`.
3.  The UI component dispatches an event: `eventBus.emit('chat:send_message', { recipient: '...', content: '...', annotations: [...] })`.
4.  The `chat` module's `handleEvent` function receives the request.
5.  It encrypts the message content and annotations for the recipient.
6.  It determines the best transport protocol (e.g., GUN.eco for a group chat) and sends the encrypted payload.
7.  Later, the manager of "Project X" can perform a semantic query across all project-related chats for any messages containing an uncompleted `cml:Task`, allowing them to discover action items without manually reading every message.
