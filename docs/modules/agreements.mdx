# Module: Agreements

**The Agreements module provides the framework for creating, managing, and securely signing formal, RDF-based agreements between users. This module is essential for establishing high-trust interactions, such as connection requests, content licenses, and work contracts.**

By representing agreements as structured, signed data, Webizen transforms them from static legal text into dynamic, machine-readable contracts that can be automatically validated and enforced.

## Purpose and Functionality

The primary goal of the `agreements` module is to formalize relationships and exchanges within the Webizen ecosystem in a secure, transparent, and verifiable manner.

**Core Functions:**
-   **Agreement Creation:** Provides UI and logic for users to draft agreements based on predefined templates (e.g., a standard "Contact Connection Request").
-   **RDF-based Structure:** All agreements are structured as RDF data, using ontologies like ODRL to define the terms, permissions, and duties of the parties involved.
-   **IPFS Storage:** The finalized RDF agreement is stored as an immutable file on IPFS, ensuring its content cannot be altered after creation.
-   **SHACL Validation:** Before an agreement is finalized, its RDF structure is validated against a corresponding SHACL shape (e.g., `agreements-v1.shacl.ttl`) to guarantee it is well-formed and complete.
-   **Post-Quantum Signatures:** To ensure long-term, non-repudiable authenticity, all agreements are digitally signed using the **SPHINCS+** post-quantum signature algorithm.

## Technical Implementation

-   **Module Path**: `src/modules/agreements/index.js`
-   **UI Component**: The interface for creating and viewing agreements is rendered by `src/components/Agreements.js`.
-   **Core Libraries**:
    -   `shacl-validator`: For validating the structure of the agreement's RDF data.
-   **Ontologies**:
    -   `ontologies/agreements-v1.shacl.ttl`: Defines the required shape for a valid agreement.
    -   `ODRL`: The Open Digital Rights Language is often used within agreements to specify permissions and duties.
-   **Dependencies**:
    -   `services/crypto`: Used to sign the final agreement hash with SPHINCS+.
    -   `services/ipfs`: To store the agreement file and get its CID.
    -   `services/solidos`: To store the record of the agreement (including the IPFS CID and signature) in the user's Solid Pod.
    -   `modules/addressbook`: To link agreements to the specific contacts involved.

### Example Flow: Creating a Connection Request

1.  User Alice wants to formally connect with Bob. She navigates to Bob's profile in her address book and clicks "Create Agreement," selecting the "Contact Connection" template.
2.  The `Agreements.js` component presents a pre-filled form based on the template. Alice adds a personal note and clicks "Propose."
3.  The UI dispatches an event to the `agreements` module with the agreement data.
4.  The `agreements` module constructs the final RDF data for the agreement.
5.  It validates this data against `agreements-v1.shacl.ttl`. If valid, it proceeds.
6.  It saves the RDF data to a file and adds it to IPFS, receiving a `cid`.
7.  It then calls the `crypto` service to sign the `cid` using the `'agreement'` policy, which resolves to **SPHINCS+**.
8.  The module creates a final RDF record containing the `cid` and the `signatureObject`, saves this record to Alice's Solid Pod, and sends a message to Bob with the record's location.
9.  Bob's client can then fetch the agreement from IPFS, verify the SPHINCS+ signature against Alice's WebID, and choose to accept or reject the connection.
